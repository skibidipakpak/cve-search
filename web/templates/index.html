{% extends 'layouts/master-page.html' %}
{% block title %}Most recent entries{% endblock %}
{% block head %}
<!-- css -->
<link href="{{ url_for('static', filename='css/custom/filter.css') }}" rel="stylesheet" />
<link href="{{ url_for('static', filename='css/dataTables.bootstrap4.min.css') }}" rel="stylesheet" />

<!-- javascript -->
<script type="text/javascript" src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/dataTables.bootstrap4.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/custom/filter.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/custom/CVEsDataTable.js') }}"></script>
{% endblock %}
{% block content %}
<!-- breadcrumb -->
{% include 'subpages/breadcrumbs.html' %}
<!-- Filter options -->
{% include 'subpages/filters.html' %}
<!-- Search results -->
{% include 'subpages/table.html' %}
{% endblock %}

{% block body_scripts %}
<script>
function getFormData(top){

    if (top !== "top") {
      $('#filter-toggle').click();
    }

    var form_elements = document.getElementById('filter').elements;

    value_dict = {};

    for (var i = 0; i < form_elements.length; i++) {
        if (form_elements[i].id != "filter_send" && form_elements[i].id != "filter_reset") {
          value_dict[form_elements[i].id] = form_elements[i].value
        }
    }

    $.ajax({
            url: "/set_filter",
            type: "post",
            data: JSON.stringify(value_dict),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(response) {
               //
            },
            error: function(xhr) {
               //Do Something to handle error
            },
            complete: function(data) {
              var table = $('#CVEs').DataTable();
              table.ajax.reload();
              $('#filter_off').addClass('d-none');
              $('#filter_on').removeClass('d-none');
            }
        });
}

function reset_filters() {
  $.ajax({
            url: "/reset_filter",
            type: "get",
            success: function(response) {
               //
            },
            error: function(xhr) {
               //Do Something to handle error
            },
            complete: function(data) {
              var table = $('#CVEs').DataTable();
              table.ajax.reload();
              $('#filter_off').removeClass('d-none');
              $('#filter_on').addClass('d-none');
            }
        });
}
</script>
<script>
function ConvertDateTime(datetimestring) {

  var date = new Date(datetimestring)

  return date.toISOString().substring(0, 10) + ' - ' + date.toTimeString().substring(0, 5);
}
</script>
<script>
  function escapeHtml(unsafe) {
    return unsafe
         .replace(/&/g, "&amp;")
         .replace(/</g, "&lt;")
         .replace(/>/g, "&gt;")
         .replace(/"/g, "&quot;")
         .replace(/'/g, "&#039;");
 }
</script>
<script>
  $(document).ready(function() {
    loadCVEsDataTable({{pageLength}});
    check_filter_active();
    autoClearFilterError();
  });
</script>
{% endblock %}
