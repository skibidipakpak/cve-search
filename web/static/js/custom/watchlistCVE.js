function loadPluginActions(){
    $.getJSON('/plugin/_get_cve_actions',{cve: $("#_cveID").val()},function(data){
      actions = data["actions"]
      $("#cve_actions").empty()
      $("#cve_actions").append('<button class="btn btn-outline-success btn-sm" id="copy-button" data-clipboard-target="#cveInfo"><i class="far fa-clipboard"></i> Copy to Clipboard</button><br />')
      $("#cve_actions").append('</br><button class="btn btn-outline-success btn-sm" id="mail-button" onclick="generateNotice()"><i class="far fa-envelope-open"></i></i> Generate security notice</button><br />')
      for(var i=0; i < actions.length; i++){
        if(('icon' in actions[i]) || ('text' in actions[i])){
          add="<button id='action-"+i+"'>"
          if('icon' in actions[i]){add+="<i class=" + actions[i]['icon'] + "></i> "}
          if('text' in actions[i]){add+=actions[i]['text']}
          add+="</button><br />"
          $("#cve_actions").append(add);
          if('action' in actions[i]){
            $("#action-"+i).attr('id', "action-"+actions[i]['plugin']+"-"+actions[i]['action'])
            $("#action-"+actions[i]['plugin']+"-"+actions[i]['action']).click(function(e){
              plugin = this.id.split("-")[1]
              act = this.id.split("-")[2]
              $.getJSON('/plugin/'+plugin+'/_cve_action/'+act,{cve: $("#_cveID").val()},function(data){
                parseStatus(data)
                loadPluginActions()
              })
            })
          }
        }
      }
    })
  }

  function generateNotice(){
    document.getElementById("overlay").style.display = "block";
  }
  
  function overlayoff() {
    document.getElementById("overlay").style.display = "none";
  }
  
  $(document).ready(function() {
    loadPluginActions();
  
    initClipboard()
  
  });
  
  function initClipboard(){
  
      var clipboard = new ClipboardJS('#copy-button');
  
      clipboard.on('success', function(e) {
          e.clearSelection();
      });
  
      clipboard.on('error', function(e) {
          console.error('Action:', e.action);
          console.error('Trigger:', e.trigger);
      });
  }
  
function saveComment(id, entity, product) {
    var comment = document.getElementById('comment'+id+entity+product).value;
    if (comment != null) {
        data = {'comment': comment, 'id': id, 'entity': entity, 'product': product}
        $.ajax({
            type: "post",
            url: '/save_comment',
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(response) {
                parseStatus(response['status'])
            },
            error: function(xhr, ajaxOptions, thrownError) {
                showMessage(thrownError, "error")
            }
        });
    } 
}

function printNotice(cvesummary, impact, exploitability) {
    var cveid = document.getElementById('inputCveId').value
    var product = document.getElementById('inputProduct').value
    var severity = document.getElementById('inputSeverity').value
    var remediations = document.getElementById('inputRemediation').value
    data = {'cveid':cveid, 'product':product, 'severity':severity, 'remediations':remediations, 
    'cvesummary':cvesummary, 'impact':impact, 'exploitability':exploitability}
    $.ajax({
        type: "post",
        url: '/exportNotice',
        data: JSON.stringify(data),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(response) {
            parseStatus(response['status'])
            Download("../static/export/notice")
        },
        error: function(xhr, ajaxOptions, thrownError) {
            showMessage(thrownError, "error")
        }
    });
}

function Download(url) {
    document.getElementById('notice-download').src = url;
};