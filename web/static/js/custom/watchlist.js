

function switchStatus(id, entity, product, treated) {
    data = {'id': id, 'entity': entity, 'product': product}
    if (treated == false){
        document.getElementById(id+entity+product+'_treated').innerHTML = '<button data-toggle="tooltip" data-placement="top" title="Mark as not treated" class="btn btn-success btn-sm" onclick="switchStatus(\'' + id +'\',\'' + entity +'\',\'' + product + '\', true)"><i class="fas fa-check-circle"></i></button>'
    } else {
        document.getElementById(id+entity+product+'_treated').innerHTML = '<button data-toggle="tooltip" data-placement="top" title="Mark as treated" class="btn btn-danger btn-sm" onclick="switchStatus(\'' + id +'\',\'' + entity +'\',\'' + product +  '\', false)"><i class="fas fa-times-circle"></i></button>'
    }
    $.ajax({
        type: "post",
        url: '/switch_status',
        data: JSON.stringify(data),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(response) {
            parseStatus(response['status'])
        },
        error: function(xhr, ajaxOptions, thrownError) {
            showMessage(thrownError, "error")
        }
    });
} 

function delete_from_watchlist(id, entity, product) {
    var r = confirm("Delete CVE from watchlist?");
    if (r == false) {
        return;
    } 
    var cves = document.getElementsByClassName(id + '_' + entity + '_' + product);
    for (let item of cves) {
        item.style.display = 'none';
    }
    data = {'id': id, 'entity': entity, 'product': product}
    $.ajax({
        type: "post",
        url: '/delete_from_watchlist',
        data: JSON.stringify(data),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(response) {
            parseStatus(response['status'])
        },
        error: function(xhr, ajaxOptions, thrownError) {
            showMessage(thrownError, "error")
        }
    });
} 

function delete_filtered_watchlist() {
    var r = confirm("Delete Current page from watchlist?");
    if (r == false) {
        return;
    } 
    var table = $('#CVEs').DataTable();
 
    var tableData = table.rows().data();
 
    data = {'data':tableData}
    $.ajax({
        type: "post",
        url: '/delete_filtered_watchlist',
        data: JSON.stringify(data),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(response) {
            parseStatus(response['status'])
            setInterval('location.reload()', 2000);
        },
        error: function(xhr, ajaxOptions, thrownError) {
            showMessage(thrownError, "error")
        }
    });
}

function exportCSV() {
    var table = $('#CVEs').DataTable();
 
    var tableData = table.rows().data();
 
    data = {'data':tableData}
    $.ajax({
        type: "post",
        url: '/exportCSV',
        data: JSON.stringify(data),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(response) {
            parseStatus(response['status'])
            Download("static/export/export.csv")
        },
        error: function(xhr, ajaxOptions, thrownError) {
            showMessage(thrownError, "error")
        }
    });
}



function Download(url) {
    document.getElementById('csv-download').src = url;
};

